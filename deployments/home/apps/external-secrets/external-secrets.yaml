apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: external-secrets
  namespace: external-secrets
spec:
  interval: 1m
  chart:
    spec:
      chart: external-secrets
      version: '0.9.16' 
      sourceRef:
        kind: HelmRepository
        name: external-secrets
        namespace: external-secrets
---
apiVersion: v1
kind: Secret
metadata:
  name: aws-external-secrets-creds
  namespace: external-secrets
type: Opaque
data:
  aws_access_key_id: PGJhc2U2NC1lbmNvZGVkLWFjY2Vzcy1rZXktaWQ+
  aws_secret_access_key: PGJhc2U2NC1lbmNvZGVkLXNlY3JldC1hY2Nlc3Mta2V5Pg==
---
apiVersion: external-secrets.io/v1beta1
kind: ClusterSecretStore
metadata:
  name: aws-cluster-secret-store
spec:
  provider:
    aws:
      service: ParameterStore
      region: eu-west-2
      auth:
        secretRef:
          accessKeyIDSecretRef:
            name: aws-external-secrets-creds
            key: aws_access_key_id
            namespace: external-secrets
          secretAccessKeySecretRef:
            name: aws-external-secrets-creds
            key: aws_secret_access_key
            namespace: external-secrets

